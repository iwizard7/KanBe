<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KanBe - Kanban Board</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body>
  <!-- Login Screen -->
  <div id="login-screen" class="login-screen">
    <div class="login-container">
      <div class="login-logo">
        <div class="logo-icon">üìã</div>
        <h1>KanBe</h1>
      </div>
      <form id="login-form" class="login-form">
        <div class="input-group">
          <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
        </div>
        <button type="submit" class="btn-primary btn-wide">–í–æ–π—Ç–∏</button>
        <div id="login-error" class="error-message"></div>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div id="app" class="app hidden">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <span class="logo-icon">üìã</span>
          <span class="logo-text">KanBe</span>
        </div>
        <div class="search-box">
          <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á –∏–ª–∏ Swimlanes...">
          <span class="search-icon">üîç</span>
        </div>
        <div class="project-filter">
          <select id="project-filter-select">
            <option value="all">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
            <option value="none">–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞</option>
          </select>
        </div>
      </div>
      <div class="header-right">
        <button id="theme-toggle-btn" class="btn-icon" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
        <button id="show-archive-btn" class="btn-icon" title="–ê—Ä—Ö–∏–≤">üì¶</button>
        <button id="show-settings-btn" class="btn-icon" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
        <button id="add-column-btn" class="btn-secondary">+ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É</button>
        <button id="logout-btn" class="btn-icon" title="–í—ã–π—Ç–∏">üö™</button>
      </div>
    </header>

    <!-- Board -->
    <main class="board-container">
      <div id="board" class="board"></div>
    </main>
  </div>

  <!-- Task Modal -->
  <div id="task-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</h2>
        <div style="display: flex; gap: 8px;">
          <button type="button" class="btn-icon-small" onclick="openHistoryModal(currentEditingTask)"
            id="modal-history-btn" title="–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π">üïí</button>
          <button type="button" class="btn-close" onclick="closeTaskModal()">√ó</button>
        </div>
      </div>
      <form id="task-form">
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
          <input type="text" id="task-title" required>
        </div>

        <div class="form-group">
          <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
          <textarea id="task-description" rows="3"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
            <select id="task-priority">
              <option value="low">–ù–∏–∑–∫–∏–π</option>
              <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
              <option value="high">–í—ã—Å–æ–∫–∏–π</option>
            </select>
          </div>

          <div class="form-group">
            <label>–î–µ–¥–ª–∞–π–Ω</label>
            <input type="date" id="task-deadline">
          </div>
        </div>

        <div class="form-group">
          <label>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ</label>
          <select id="task-recurring">
            <option value="none" selected>–ë–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</option>
            <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
            <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
          </select>
          <p class="hint">–ù–æ–≤–∞—è –∫–æ–ø–∏—è –∑–∞–¥–∞—á–∏ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ.</p>
        </div>

        <div class="form-group">
          <label>–¢—ç–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
          <input type="text" id="task-tags" placeholder="frontend, bug, urgent">
        </div>

        <div class="form-group">
          <label>–ü—Ä–æ–µ–∫—Ç</label>
          <select id="task-project">
            <option value="">–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞</option>
          </select>
        </div>

        <div class="form-group">
          <label>–°–≤—è–∑–∏ (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏)</label>
          <div id="task-links-container" class="task-links-list"></div>
          <div class="link-selector">
            <select id="link-task-id">
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–ª—è —Å–≤—è–∑–∏...</option>
            </select>
            <button type="button" class="btn-text" onclick="addTaskLink()">+ –°–≤—è–∑–∞—Ç—å</button>
          </div>
        </div>

        <div class="form-group">
          <label>–ü–æ–¥–∑–∞–¥–∞—á–∏</label>
          <div id="subtasks-container"></div>
          <button type="button" class="btn-text" onclick="addSubtaskField()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É</button>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="closeTaskModal()">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button type="button" id="archive-task-btn" class="btn-icon hidden" title="–í –∞—Ä—Ö–∏–≤"
            onclick="archiveTask()">üì¶</button>
          <button type="button" id="delete-task-btn" class="btn-danger hidden" onclick="deleteTask()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Column Edit Modal -->
  <div id="column-modal" class="modal hidden">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 id="column-modal-title">–ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞</h2>
        <button class="btn-close" onclick="closeColumnModal()">√ó</button>
      </div>
      <form id="column-form">
        <label for="column-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏</label>
        <input type="text" id="column-title" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í —Ä–∞–±–æ—Ç–µ">

        <label for="column-wip">WIP-–ª–∏–º–∏—Ç (0 - –±–µ–∑ –ª–∏–º–∏—Ç–∞)</label>
        <input type="number" id="column-wip" min="0" value="0">

        <div class="modal-footer">
          <button type="button" id="delete-column-btn" class="btn-danger hidden">–£–¥–∞–ª–∏—Ç—å</button>
          <div style="flex-grow: 1;"></div>
          <button type="button" class="btn-text" onclick="closeColumnModal()">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Task History Modal -->
  <div id="history-modal" class="modal hidden">
    <div class="modal-content history-modal-content">
      <div class="modal-header">
        <h2 id="history-title">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞—á–∏</h2>
        <button class="btn-icon" onclick="closeHistoryModal()">√ó</button>
      </div>
      <div id="history-list" class="history-list">
        <!-- History items will be here -->
      </div>
    </div>
  </div>

  <!-- Archive Modal -->
  <div id="archive-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>–ê—Ä—Ö–∏–≤ –∑–∞–¥–∞—á</h2>
        <button class="btn-close" onclick="closeArchiveModal()">√ó</button>
      </div>
      <div class="archive-list" id="archive-list">
        <!-- Archived tasks will appear here -->
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
        <button class="btn-close" onclick="closeSettingsModal()">√ó</button>
      </div>
      <div class="settings-body">
        <section class="settings-section">
          <h3>üóÇÔ∏è –ü—Ä–æ–µ–∫—Ç—ã</h3>
          <p class="hint">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–ø–∏—Å–∫–æ–º –ø—Ä–æ–µ–∫—Ç–æ–≤. –ö–∞–∂–¥—ã–π –ø—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Å–≤–æ–π —Ü–≤–µ—Ç.</p>
          <div id="projects-list" class="projects-list"></div>
          <div class="project-add-form">
            <input type="text" id="new-project-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" class="project-input">
            <input type="color" id="new-project-color" value="#818cf8" class="project-color-picker">
            <button type="button" class="btn-primary" style="padding: 8px 16px; font-size: 13px;"
              onclick="addProject()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
        </section>
        <section class="settings-section">
          <h3>üì¶ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
          <p class="hint">–ü–æ–ª–Ω—ã–π –¥–∞–º–ø –¥–æ—Å–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö.</p>
          <div class="settings-btns">
            <button onclick="exportBoard()" class="btn-secondary">üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            <button onclick="document.getElementById('import-input').click()" class="btn-secondary">üì§
              –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            <input type="file" id="import-input" hidden accept=".json" onchange="importBoard(event)">
          </div>
        </section>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>

</html>